{"version":3,"sources":["bezier.js","index.js"],"names":["BezierMaker","ctx","bezierCtrlNodesArr","num","console","log","bezierArr","initBezier","t","x","y","n","length","forEach","item","index","Math","pow","factorial","nodeArr","warn","startNode","endNode","moveTo","lineTo","strokeStyle","color","stroke","i","push","bezier","beginPath","arc","PI","closePath","save","fillStyle","fill","restore","b","setTimeout","rnd","flag","random","FlyHeart","img","heart","position","shift","clear","globalAlpha","drawImage","prevPosition","clearRect","main","heartArr","cvs","document","getElementById","getContext","boy","girl","draw","indexOf","splice","requestAnimationFrame","el","addEventListener","classList","remove","body","add"],"mappings":"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","file":"bezier.e31bb0bc.map","sourceRoot":"..","sourcesContent":["export default class BezierMaker {\n  constructor(ctx, bezierCtrlNodesArr, num) {\n    this.ctx = ctx;\n    console.log(bezierCtrlNodesArr)\n    this.bezierCtrlNodesArr = bezierCtrlNodesArr ? bezierCtrlNodesArr : [];\n    this.bezierArr = [];\n    this.initBezier(num);\n  }\n  bezier(t) {\n    //贝塞尔公式调用\n    var x = 0,\n      y = 0,\n      bezierCtrlNodesArr = this.bezierCtrlNodesArr,\n      n = bezierCtrlNodesArr.length - 1;\n    bezierCtrlNodesArr.forEach((item, index) => {\n      if (!index) {\n        x += item.x * Math.pow(1 - t, n - index) * Math.pow(t, index);\n        y += item.y * Math.pow(1 - t, n - index) * Math.pow(t, index);\n      } else {\n        x +=\n          (this.factorial(n) /\n            this.factorial(index) /\n            this.factorial(n - index)) *\n          item.x *\n          Math.pow(1 - t, n - index) *\n          Math.pow(t, index);\n        y +=\n          (this.factorial(n) /\n            this.factorial(index) /\n            this.factorial(n - index)) *\n          item.y *\n          Math.pow(1 - t, n - index) *\n          Math.pow(t, index);\n      }\n    });\n    return {\n      x: x,\n      y: y\n    };\n  }\n  initBezier(num) {\n    //通过控制点算出实时xy值渲染到canvas\n    var nodeArr = this.bezierCtrlNodesArr;\n    if (nodeArr.length === 2) {\n      console.warn(\"Control nodes should be more then two!\");\n      var startNode = nodeArr[0],\n        endNode = nodeArr[1];\n      this.ctx.moveTo(startNode.x, startNode.y);\n      this.ctx.lineTo(endNode.x, endNode.y);\n      this.ctx.strokeStyle = this.color;\n      this.ctx.stroke();\n    } else {\n      for (let i = 0; i < 1; i += 1 / num) {\n        this.bezierArr.push(this.bezier(i));\n      }\n    }\n  }\n  factorial (num) {\n    //递归阶乘\n    if (num <= 1) {\n      return 1;\n    } else {\n      return num * this.factorial(num - 1);\n    }\n  }\n  showCtrlNodes(ctx) {\n    this.ctx = this.ctx || ctx;\n    this.bezierCtrlNodesArr.forEach(n => {\n      this.ctx.beginPath();\n      this.ctx.arc(n.x, n.y, 2, 0, 2 * Math.PI);\n      this.ctx.closePath();\n      this.ctx.save();\n      this.ctx.fillStyle = this.color;\n      this.ctx.fill();\n      this.ctx.restore();\n    });\n  }\n  showBezierArr () {\n    this.bezierArr.forEach(b => {\n      this.ctx.beginPath();\n      this.ctx.arc(b.x, b.y, 2, 0, 2 * Math.PI);\n      this.ctx.closePath();\n      this.ctx.fill();\n    });\n  }\n  animateBezier() {\n    this.bezierArr.forEach((b, index) => {\n      setTimeout(() => {\n        this.ctx.beginPath();\n        this.ctx.arc(b.x, b.y, 2, 0, 2 * Math.PI);\n        this.ctx.closePath();\n        this.ctx.fill();\n      }, 20 * index);\n    });\n  }\n}\n","import BezierMaker from './bezier.js'\n\n// console.log(bezier)\n// ctx.fillRect(0, 0, 100, 100);\n// ctx.drawImage(heart, 200, 200, 20, 20);\nfunction rnd () {\n  let flag = Math.random() > 0.5 ? 1 : -1\n  return 80 * Math.random() * flag\n}\nclass FlyHeart {\n  constructor (ctx, img) {\n    this.ctx = ctx;\n    this.img = heart;\n    this.bezierArr = new BezierMaker(ctx, [\n      {x: 187, y: 245},\n      {x: 170 + rnd(), y: 200},\n      {x: 200 + rnd() , y: 120}, \n      {x: 140 + rnd(), y: 60}], 90).bezierArr\n  }\n  draw () {\n    let position = this.bezierArr.shift();\n    this.clear()\n    if (position) {\n      this.ctx.save()\n      this.ctx.globalAlpha = this.bezierArr.length / 30\n      this.ctx.drawImage(this.img, position.x , position.y, 20, 20);\n      this.ctx.restore()\n      this.prevPosition = position\n    }\n  }\n  clear () {\n    if (this.prevPosition) {\n      this.ctx.clearRect(this.prevPosition.x, this.prevPosition.y, 20, 20 )\n    }\n  }\n}\n\nfunction main () {\n  let heartArr = []\n  const cvs = document.getElementById('cvs')\n  const ctx = cvs.getContext('2d')\n  const heart = document.getElementById('heart')\n  const boy = document.getElementById('boy')\n  const girl = document.getElementById('girl')\n  // ctx.drawImage(boy, 120, 250, 200, 200 * 384 / 928);\n  // ctx.drawImage(girl, 120, 250, 200, 200 * 384 / 928);\n  function draw () {\n    if(heartArr.length) {\n      for(let heart of heartArr) {\n        heart.draw();\n        if(heart.bezierArr.length === 0) {\n          heart.clear();\n          let index = heartArr.indexOf(heart)\n          heartArr.splice(index, 1)\n        }\n      }\n    }\n    requestAnimationFrame(draw)\n  }\n  [boy, girl].forEach(function(el){\n    el.addEventListener('animationend', function(){\n      el.classList.remove('kiss')\n    })\n  })\n  document.body.addEventListener('click', function() {\n    heartArr.push(new FlyHeart(ctx, heart));\n    boy.classList.add('kiss');\n    girl.classList.add('kiss');\n\n  })\n  draw()\n}\nmain()"]}