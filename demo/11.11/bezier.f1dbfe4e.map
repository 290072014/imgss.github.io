{"version":3,"sources":["bezier.js","index.js"],"names":["BezierMaker","ctx","bezierCtrlNodesArr","num","console","log","bezierArr","initBezier","t","x","y","n","length","forEach","item","index","factorial","Math","pow","nodeArr","warn","startNode","endNode","moveTo","lineTo","strokeStyle","color","stroke","i","push","bezier","beginPath","arc","PI","closePath","save","fillStyle","fill","restore","b","setTimeout","rnd","flag","random","FlyHeart","img","heart","position","shift","clear","globalAlpha","drawImage","prevPosition","clearRect","main","heartArr","document","getElementById","getContext","boy","girl","el","addEventListener","classList","remove","body","add","draw","indexOf","splice","requestAnimationFrame"],"mappings":"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","file":"bezier.f1dbfe4e.map","sourceRoot":"..","sourcesContent":["export default class BezierMaker {\n  constructor(ctx, bezierCtrlNodesArr, num) {\n    this.ctx = ctx;\n    console.log(bezierCtrlNodesArr)\n    this.bezierCtrlNodesArr = bezierCtrlNodesArr ? bezierCtrlNodesArr : [];\n    this.bezierArr = [];\n    this.initBezier(num);\n  }\n  bezier(t) {\n    //贝塞尔公式调用\n    var x = 0,\n      y = 0,\n      bezierCtrlNodesArr = this.bezierCtrlNodesArr,\n      n = bezierCtrlNodesArr.length - 1;\n    bezierCtrlNodesArr.forEach((item, index) => {\n      if (!index) {\n        x += item.x * Math.pow(1 - t, n - index) * Math.pow(t, index);\n        y += item.y * Math.pow(1 - t, n - index) * Math.pow(t, index);\n      } else {\n        x +=\n          (this.factorial(n) /\n            this.factorial(index) /\n            this.factorial(n - index)) *\n          item.x *\n          Math.pow(1 - t, n - index) *\n          Math.pow(t, index);\n        y +=\n          (this.factorial(n) /\n            this.factorial(index) /\n            this.factorial(n - index)) *\n          item.y *\n          Math.pow(1 - t, n - index) *\n          Math.pow(t, index);\n      }\n    });\n    return {\n      x: x,\n      y: y\n    };\n  }\n  initBezier(num) {\n    //通过控制点算出实时xy值渲染到canvas\n    var nodeArr = this.bezierCtrlNodesArr;\n    if (nodeArr.length === 2) {\n      console.warn(\"Control nodes should be more then two!\");\n      var startNode = nodeArr[0],\n        endNode = nodeArr[1];\n      this.ctx.moveTo(startNode.x, startNode.y);\n      this.ctx.lineTo(endNode.x, endNode.y);\n      this.ctx.strokeStyle = this.color;\n      this.ctx.stroke();\n    } else {\n      for (let i = 0; i < 1; i += 1 / num) {\n        this.bezierArr.push(this.bezier(i));\n      }\n    }\n  }\n  factorial (num) {\n    //递归阶乘\n    if (num <= 1) {\n      return 1;\n    } else {\n      return num * this.factorial(num - 1);\n    }\n  }\n  showCtrlNodes(ctx) {\n    this.ctx = this.ctx || ctx;\n    this.bezierCtrlNodesArr.forEach(n => {\n      this.ctx.beginPath();\n      this.ctx.arc(n.x, n.y, 2, 0, 2 * Math.PI);\n      this.ctx.closePath();\n      this.ctx.save();\n      this.ctx.fillStyle = this.color;\n      this.ctx.fill();\n      this.ctx.restore();\n    });\n  }\n  showBezierArr () {\n    this.bezierArr.forEach(b => {\n      this.ctx.beginPath();\n      this.ctx.arc(b.x, b.y, 2, 0, 2 * Math.PI);\n      this.ctx.closePath();\n      this.ctx.fill();\n    });\n  }\n  animateBezier() {\n    this.bezierArr.forEach((b, index) => {\n      setTimeout(() => {\n        this.ctx.beginPath();\n        this.ctx.arc(b.x, b.y, 2, 0, 2 * Math.PI);\n        this.ctx.closePath();\n        this.ctx.fill();\n      }, 20 * index);\n    });\n  }\n}\n","import BezierMaker from './bezier.js'\n\n// console.log(bezier)\n// ctx.fillRect(0, 0, 100, 100);\n// ctx.drawImage(heart, 200, 200, 20, 20);\nfunction rnd () {\n  let flag = Math.random() > 0.5 ? 1 : -1\n  return 80 * Math.random() * flag\n}\nclass FlyHeart {\n  constructor (ctx, img) {\n    this.ctx = ctx;\n    this.img = heart;\n    this.bezierArr = new BezierMaker(ctx, [\n      {x: 187, y: 245},\n      {x: 170 + rnd(), y: 200},\n      {x: 200 + rnd() , y: 120}, \n      {x: 140 + rnd(), y: 60}], 90).bezierArr\n  }\n  draw () {\n    let position = this.bezierArr.shift();\n    this.clear()\n    if (position) {\n      this.ctx.save()\n      this.ctx.globalAlpha = this.bezierArr.length / 30\n      this.ctx.drawImage(this.img, position.x , position.y, 20, 20);\n      this.ctx.restore()\n      this.prevPosition = position\n    }\n  }\n  clear () {\n    if (this.prevPosition) {\n      this.ctx.clearRect(this.prevPosition.x, this.prevPosition.y, 20, 20 )\n    }\n  }\n}\n\nfunction main () {\n  let heartArr = []\n  const cvs = document.getElementById('cvs')\n  const ctx = cvs.getContext('2d')\n  const heart = document.getElementById('heart')\n  const boy = document.getElementById('boy')\n  const girl = document.getElementById('girl')\n  // ctx.drawImage(boy, 120, 250, 200, 200 * 384 / 928);\n  // ctx.drawImage(girl, 120, 250, 200, 200 * 384 / 928);\n  function draw () {\n    if(heartArr.length) {\n      for(let heart of heartArr) {\n        heart.draw();\n        if(heart.bezierArr.length === 0) {\n          heart.clear();\n          let index = heartArr.indexOf(heart)\n          heartArr.splice(index, 1)\n        }\n      }\n    }\n    requestAnimationFrame(draw)\n  }\n  [boy, girl].forEach(function(el){\n    el.addEventListener('animationend', function(){\n      el.classList.remove('kiss')\n    })\n  })\n  document.body.addEventListener('click', function() {\n    heartArr.push(new FlyHeart(ctx, heart));\n    boy.classList.add('kiss');\n    girl.classList.add('kiss');\n\n  })\n  draw()\n}\nmain()"]}